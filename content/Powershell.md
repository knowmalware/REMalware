# Powershell

## Introduction

PowerShell has become a [very popular](https://attack.mitre.org/wiki/PowerShell) tool / programming language for cyber intrusions.  Not the least because of the freely available frameworks and examples:

- [Exploit Monday blog post](http://www.exploit-monday.com/2011/11/powersyringe-powershell-based-codedll.html) on 21 November 2011
- [GrayHatHacker.NET blog post](https://www.greyhathacker.net/?p=500) on 6 January 2012
- [PowerSploit](https://github.com/PowerShellMafia/PowerSploit) - first commit May 2012
- [Social Engineering Tookit](https://cyberarms.wordpress.com/2012/08/02/social-engineering-toolkit-bypassing-anti-virus-using-powershell/) uses Powershell in August 2012
- [Veil](https://github.com/Veil-Framework/Veil) - "Evasion" powershell payload first commit June 2013
- [Nishang](https://github.com/samratashok/nishang) - first commit May 2014
- [Powershell Empire](https://github.com/EmpireProject/Empire) - first commit Aug 2015
- [PSAttack](https://github.com/jaredhaight/PSAttack) - first commit Oct 2015

By 2014, adversarial usage of powershell is reported:

- [Operation Double Tap](https://www.fireeye.com/blog/threat-research/2014/11/operation_doubletap.html) - November 2014
    - simple 1st-stage downloader
- [Deep in Thought: Chinese Targeting of National Security Think Tanks](https://www.crowdstrike.com/blog/deep-thought-chinese-targeting-national-security-think-tanks/) - July 2014
    - persistant reverse shell (via IEX)
    - more complex 2nd-stage downloader / self-injecter

By 2016, the use of PowerShell scripts for cyber intrusions became popular, and with them, anti-analysis techniques.  Daniel Bohannon's [Invoke-Obfuscation](https://github.com/danielbohannon/Invoke-Obfuscation) provides many examples of these techniques.


## Analysis Tools

### IDE's / Debuggers

- [Powershell ISE]()
    - Step 1: Update-Help (if online)
- [Visual Studio Code](https://docs.microsoft.com/en-us/powershell/scripting/core-powershell/vscode/using-vscode)

### Other

- [Revoke-Obfuscation](https://github.com/danielbohannon/Revoke-Obfuscation)
    - the name is misleading; it only _detects_ obfuscation
- Linux/macOS shell
```shell
    $ docker pull microsoft/powershell
    $ docker run -v `pwd`:/mnt -i --rm -t microsoft/powershell
```


## Examples

- simple1\_ps
- simple2\_ps
- simple3\_obfuscated\_ps
- powershell\_obfuscated\_ps1
- [poshspy\_redacted](https://github.com/matthewdunwoody/POSHSPY/blob/master/poshspy_redacted.txt)
