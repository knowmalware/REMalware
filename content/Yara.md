# Yara

## Introduction

[Yara](https://virustotal.github.io/yara/) is an opensource project whose aim is to help malware analysts and researchers "to identify and classify malware samples."  Since version 2 in 2014, it has become the de-facto custom signature creation tool, much like snort is the reference network signature format.  Even [VirusTotal](https://virustotal.com) allows paying customers to alert on uploads based on custom Yara rules.

Rule sets and tools:

- https://github.com/Neo23x0/signature-base
- https://github.com/Yara-Rules/rules (old, but crypto and capabilities rules still useful)
- https://github.com/InQuest/awesome-yara


## Using rules

There are two ways of matching rules against files:

- the command-line program, with a small number of rules files and providing it a single file or a directory
- programmatically with a library such as libyara or yara-python

- Be aware of dependencies
    - *externals* - variables that must be defined at run-time
    - Modules (many require v3+)
    - Regex works differently in v2+

- Problems
    - malformed rules (Yara can not parse)
    - duplicate rules
        - name conflicts
        - same or very similar rules


## Writing rules

### Organizing your rules

- Private
- Tags
- Metadata
    - author - name and contact info
    - date - yyyy-mm-dd
    - description - what does this rule do
    - reference or source - link to blog, whitepaper reference, etc.
    - sample - file hashes
- C-style comments
- Normalization  (see [yaratool](https://github.com/chrislee35/yaratool))

### Sharing your rules

**DO NOT** use external variables without being VERY explicit that they are required and an example of how to run Yara with providing appropriate values to them.

**DO NOT** use lots of external variables.

